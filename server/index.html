<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="chrome=1" />
        <title>QCO Chat</title>
        <link rel="stylesheet" href="normalize.min.css" type="text/css" />
        <link rel="stylesheet" href="chat.css" type="text/css" />
        <!-- Not mobile-friendly at this time. -->
        <script src="webrtc.io.js"></script>
    </head>
    <body>
        <div id="loginFrame">
            <form name="login" action="" onSubmit="return do_login();">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" value="" size="32" />
                <input type="submit" id="submitLogin" name="submitLogin" value="Login" />
            </form>
        </div>
        <div id="chatFrame">
            <div id="video">
            </div>
            <div id="buttonBar">
                <button type="button" id="broadcastButton" onclick="broadcast()">Start Broadcasting</button>
            </div>
            <div id="chat">
                <div id="chatbox">
                    Test text<br />
                    More test text<br />
                    and more
                </div>
                <form id="messageForm" action="" onSubmit="return sendMessage();">
                    <input type="text" id="messageBox" name="message" size="500" />
                    <input type="submit" id="messageSubmit" name="messageSubmit" value="Send" />
                </form>
            </div>
        </div>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>  
    <script type="text/javascript">  
        var videos = [];
        var username = "guest";
        var broadcasting = false;
        
        function do_login() {
            username = document.getElementById("username").value.trim();
            document.getElementById("loginFrame").style.display = "none";
            document.getElementById("chatFrame").style.display = "block";
            initVideo();
            return false;
        }
        
        function initVideo() {
            if (videos.length > 0) {
                var videobox = document.getElementById("videobox");
                videobox.style.display = "block";
                for (var i=0; i<videos.length; i++) {
                    var vid = document.createElement("video");
                    vid.id = i;
                    videobox.appendChild(vid);
                }
            }
            resizeElements();
        }
        
        function resizeElements() {
            $("#messageBox").width($("#chat").width() - $("#messageSubmit").outerWidth() - 6);
            $("#chatbox").height($(window).height() - $("#chatbox").position().top - parseInt($("#chatbox").css('margin-bottom')) - $("#messageBox").height() - 64);
            console.log("Resized chatbox to height="+$("#chatbox").height());
            console.log($(window).height());
            console.log($("#chatbox").position().top);
            console.log(parseInt($("#chatbox").css('padding-bottom')));
            console.log($("#messageSubmit").outerWidth());
        }
        
        function broadcast() {
            console.log("Broadcasting...");
            broadcasting = !broadcasting;
            if (broadcasting)
                document.getElementById("broadcastButton").innerHTML = "Stop Broadcasting";
            else
                document.getElementById("broadcastButton").innerHTML = "Start Broadcasting";
        }
        
        function sendMessage() {
            $("#messageBox").val("");
            return false;
        }
        
        window.onresize = function() {
            resizeElements();
        }
    </script> 
    </body>
</html>
    
